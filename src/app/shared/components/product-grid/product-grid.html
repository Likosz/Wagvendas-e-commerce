<div class="product-grid-container">
  <!-- Toolbar -->
  <div
    class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6 p-4 bg-white dark:bg-dark-900 rounded-xl shadow-sm"
  >
    <!-- Left: Product Count + Mobile Filter Button -->
    <div class="flex items-center gap-4 w-full sm:w-auto">
      <!-- Mobile Filter Button -->
      <button
        type="button"
        (click)="onOpenFilters()"
        class="lg:hidden px-4 py-2.5 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-colors flex items-center gap-2 focus:outline-none focus-visible:ring-4 focus-visible:ring-primary-500/50"
        aria-label="Abrir filtros"
      >
        <lucide-icon [img]="icons.SlidersHorizontal" [size]="18"></lucide-icon>
        <span>Filtros</span>
      </button>

      <!-- Product Count -->
      <div class="flex-1">
        <p class="text-sm text-dark-600 dark:text-dark-400">
          Mostrando
          <span class="font-semibold text-dark-900 dark:text-white">{{ products.length }}</span>
          de
          <span class="font-semibold text-dark-900 dark:text-white">{{ totalProducts }}</span>
          produtos
        </p>
      </div>
    </div>

    <!-- Right: View Mode + Sort -->
    <div class="flex items-center gap-3 w-full sm:w-auto">
      <div
        class="hidden sm:flex items-center gap-1 p-1 bg-dark-100 dark:bg-dark-800 rounded-lg"
        role="group"
        aria-label="Modo de visualização"
      >
        <button
          type="button"
          (click)="setViewMode('grid')"
          [class.bg-white]="viewMode() === 'grid'"
          [class.dark:bg-dark-700]="viewMode() === 'grid'"
          [class.text-primary-600]="viewMode() === 'grid'"
          [class.dark:text-primary-400]="viewMode() === 'grid'"
          [class.text-dark-600]="viewMode() !== 'grid'"
          [class.dark:text-dark-400]="viewMode() !== 'grid'"
          class="p-2 rounded-md transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500"
          [attr.aria-label]="'Visualizar em grade'"
          [attr.aria-pressed]="viewMode() === 'grid'"
        >
          <lucide-icon [img]="icons.Grid3x3" [size]="18"></lucide-icon>
        </button>

        <button
          type="button"
          (click)="setViewMode('list')"
          [class.bg-white]="viewMode() === 'list'"
          [class.dark:bg-dark-700]="viewMode() === 'list'"
          [class.text-primary-600]="viewMode() === 'list'"
          [class.dark:text-primary-400]="viewMode() === 'list'"
          [class.text-dark-600]="viewMode() !== 'list'"
          [class.dark:text-dark-400]="viewMode() !== 'list'"
          class="p-2 rounded-md transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500"
          [attr.aria-label]="'Visualizar em lista'"
          [attr.aria-pressed]="viewMode() === 'list'"
        >
          <lucide-icon [img]="icons.List" [size]="18"></lucide-icon>
        </button>
      </div>

      <!-- Sort Dropdown -->
      <div class="flex-1 sm:flex-initial">
        <label for="sort-select" class="sr-only">Ordenar por</label>
        <select
          id="sort-select"
          [value]="selectedSort()"
          (change)="onSortChange($any($event.target).value)"
          class="w-full px-4 py-2.5 bg-white dark:bg-dark-800 border border-dark-200 dark:border-dark-700 text-dark-900 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 cursor-pointer transition-colors"
          aria-label="Ordenar produtos"
        >
          @for (option of sortOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
      </div>
    </div>
  </div>

  <!-- Product Grid/List -->
  @if (loading) {
    <!-- Skeleton Loaders -->
    <div
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
      role="status"
      aria-label="Carregando produtos"
    >
      @for (skeleton of skeletonArray(); track skeleton) {
        <app-product-card [loading]="true"></app-product-card>
      }
    </div>
  } @else if (products.length === 0) {
    <!-- Empty State -->
    <div
      class="flex flex-col items-center justify-center py-16 px-4 bg-white dark:bg-dark-900 rounded-xl shadow-sm"
      role="status"
    >
      <div class="text-center space-y-4">
        <div
          class="w-24 h-24 mx-auto bg-dark-100 dark:bg-dark-800 rounded-full flex items-center justify-center"
        >
          <lucide-icon
            [img]="icons.Grid3x3"
            [size]="48"
            class="text-dark-400 dark:text-dark-600"
          ></lucide-icon>
        </div>
        <h3 class="text-xl font-semibold text-dark-900 dark:text-white">
          Nenhum produto encontrado
        </h3>
        <p class="text-dark-600 dark:text-dark-400 max-w-md">
          Não encontramos produtos que correspondam aos filtros selecionados. Tente ajustar seus
          critérios de busca.
        </p>
      </div>
    </div>
  } @else {
    <!-- Product Grid -->
    <div
      [class.grid]="viewMode() === 'grid'"
      [class.grid-cols-1]="viewMode() === 'grid'"
      [class.sm:grid-cols-2]="viewMode() === 'grid'"
      [class.lg:grid-cols-3]="viewMode() === 'grid'"
      [class.xl:grid-cols-4]="viewMode() === 'grid'"
      [class.flex]="viewMode() === 'list'"
      [class.flex-col]="viewMode() === 'list'"
      class="gap-6"
      role="list"
      aria-label="Lista de produtos"
    >
      @for (product of products; track product.id) {
        <app-product-card
          [product]="product"
          [loading]="false"
          (addToCart)="onAddToCart(product)"
          (toggleWishlist)="onToggleWishlist(product)"
          (quickView)="onQuickView(product)"
          role="listitem"
        ></app-product-card>
      }
    </div>
  }

  <!-- Pagination -->
  @if (!loading && products.length > 0 && totalPages > 1) {
    <nav
      class="flex flex-col sm:flex-row items-center justify-between gap-4 mt-8 p-4 bg-white dark:bg-dark-900 rounded-xl shadow-sm"
      aria-label="Navegação de páginas"
    >
      <!-- Page Info -->
      <p class="text-sm text-dark-600 dark:text-dark-400">
        Página
        <span class="font-semibold text-dark-900 dark:text-white">{{ currentPage }}</span>
        de
        <span class="font-semibold text-dark-900 dark:text-white">{{ totalPages }}</span>
      </p>

      <!-- Pagination Controls -->
      <div class="flex items-center gap-2">
        <!-- First Page -->
        <button
          type="button"
          (click)="goToFirstPage()"
          [disabled]="!canGoPrevious()"
          class="p-2 rounded-lg border border-dark-200 dark:border-dark-700 hover:bg-dark-50 dark:hover:bg-dark-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500"
          [attr.aria-label]="'Ir para primeira página'"
        >
          <lucide-icon [img]="icons.ChevronsLeft" [size]="18"></lucide-icon>
        </button>

        <!-- Previous Page -->
        <button
          type="button"
          (click)="goToPreviousPage()"
          [disabled]="!canGoPrevious()"
          class="p-2 rounded-lg border border-dark-200 dark:border-dark-700 hover:bg-dark-50 dark:hover:bg-dark-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500"
          [attr.aria-label]="'Ir para página anterior'"
        >
          <lucide-icon [img]="icons.ChevronLeft" [size]="18"></lucide-icon>
        </button>

        <!-- Page Numbers -->
        <div class="hidden sm:flex items-center gap-2">
          @for (page of visiblePages(); track $index) {
            @if (page === -1) {
              <span class="px-3 py-2 text-dark-600 dark:text-dark-400" aria-hidden="true">...</span>
            } @else {
              <!-- Page Button -->
              <button
                type="button"
                (click)="goToPage(page)"
                [class.bg-primary-600]="page === currentPage"
                [class.text-white]="page === currentPage"
                [class.hover:bg-primary-700]="page === currentPage"
                [class.border-primary-600]="page === currentPage"
                [class.dark:border-primary-600]="page === currentPage"
                [class.bg-white]="page !== currentPage"
                [class.dark:bg-dark-900]="page !== currentPage"
                [class.text-dark-900]="page !== currentPage"
                [class.dark:text-white]="page !== currentPage"
                [class.hover:bg-dark-50]="page !== currentPage"
                [class.dark:hover:bg-dark-800]="page !== currentPage"
                class="min-w-[40px] px-3 py-2 rounded-lg border border-dark-200 dark:border-dark-700 font-medium transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500"
                [attr.aria-label]="'Ir para página ' + page"
                [attr.aria-current]="page === currentPage ? 'page' : undefined"
              >
                {{ page }}
              </button>
            }
          }
        </div>

        <!-- Next Page -->
        <button
          type="button"
          (click)="goToNextPage()"
          [disabled]="!canGoNext()"
          class="p-2 rounded-lg border border-dark-200 dark:border-dark-700 hover:bg-dark-50 dark:hover:bg-dark-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500"
          [attr.aria-label]="'Ir para próxima página'"
        >
          <lucide-icon [img]="icons.ChevronRight" [size]="18"></lucide-icon>
        </button>

        <!-- Last Page -->
        <button
          type="button"
          (click)="goToLastPage()"
          [disabled]="!canGoNext()"
          class="p-2 rounded-lg border border-dark-200 dark:border-dark-700 hover:bg-dark-50 dark:hover:bg-dark-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500"
          [attr.aria-label]="'Ir para última página'"
        >
          <lucide-icon [img]="icons.ChevronsRight" [size]="18"></lucide-icon>
        </button>
      </div>
    </nav>
  }
</div>
